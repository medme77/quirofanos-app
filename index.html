<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Quir√≥fanos</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        const SUPABASE_URL = 'https://gicgkdowyexgxzremnpf.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpY2drZG93eWV4Z3h6cmVtbnBmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMDA2NTEsImV4cCI6MjA3Nzg3NjY1MX0.PNB97KW8rqjKU3SK8sN3RWFqKRMFSfk1q6hIlr0qkF4';

        const supabase = {
          async insert(table, data) {
            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
              method: 'POST',
              headers: {'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json', 'Prefer': 'return=representation'},
              body: JSON.stringify(data)
            });
            return await response.json();
          },
          async select(table) {
            const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?order=timestamp.desc`, {
              headers: {'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`}
            });
            return await response.json();
          }
        };

        const QRGen = ({ text }) => {
          const ref = useRef(null);
          useEffect(() => {
            if (text && ref.current) {
              const ctx = ref.current.getContext('2d');
              ctx.fillStyle = 'white';
              ctx.fillRect(0, 0, 200, 200);
              ctx.fillStyle = 'black';
              for (let i = 0; i < 25; i++) {
                for (let j = 0; j < 25; j++) {
                  if ((text.charCodeAt(i % text.length) * (i + 1) * (j + 1)) % 2 === 0) {
                    ctx.fillRect(i * 8, j * 8, 8, 8);
                  }
                }
              }
            }
          }, [text]);
          return <canvas ref={ref} width="200" height="200" className="border-4 border-gray-300 rounded-lg" />;
        };

        // Componente de Esc√°ner QR
        const QRScanner = ({ onScan, onClose }) => {
          const [scanning, setScanning] = useState(false);
          const scannerRef = useRef(null);

          useEffect(() => {
            let html5QrCode;

            const startScanner = async () => {
              try {
                html5QrCode = new Html5Qrcode("qr-reader");
                
                await html5QrCode.start(
                  { facingMode: "environment" },
                  {
                    fps: 10,
                    qrbox: { width: 250, height: 250 }
                  },
                  (decodedText) => {
                    html5QrCode.stop();
                    onScan(decodedText);
                  }
                );
                setScanning(true);
              } catch (err) {
                console.error("Error al iniciar c√°mara:", err);
                alert("‚ö†Ô∏è No se pudo acceder a la c√°mara. Verifica los permisos.");
              }
            };

            startScanner();

            return () => {
              if (html5QrCode && scanning) {
                html5QrCode.stop().catch(err => console.error(err));
              }
            };
          }, []);

          return (
            <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-xl p-6 max-w-md w-full">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-xl font-bold">üì∑ Escanear QR</h3>
                  <button onClick={onClose} className="text-gray-500 text-2xl">‚úï</button>
                </div>
                <div id="qr-reader" className="w-full"></div>
                <p className="text-sm text-gray-600 text-center mt-4">
                  Apunta la c√°mara al c√≥digo QR
                </p>
              </div>
            </div>
          );
        };

        function App() {
          const [view, setView] = useState('menu');
          const [quirofanos, setQuirofanos] = useState([]);
          const [registros, setRegistros] = useState([]);
          const [todosRegistros, setTodosRegistros] = useState([]);
          const [codigo, setCodigo] = useState('');
          const [loading, setLoading] = useState(false);
          const [showScanner, setShowScanner] = useState(false);
          
          const [nombre, setNombre] = useState('');
          const [cedula, setCedula] = useState('');
          const [whatsapp, setWhatsapp] = useState('');
          const [config, setConfig] = useState(false);
          const [perfilOk, setPerfilOk] = useState(false);
          
          const [esAdmin, setEsAdmin] = useState(false);
          const [adminWA, setAdminWA] = useState('');
          const [pin, setPin] = useState('');
          const [pinPrompt, setPinPrompt] = useState(false);
          const [pinInput, setPinInput] = useState('');
          const [pinSaved, setPinSaved] = useState('');

          const [editando, setEditando] = useState(null);
          const [nombreEdit, setNombreEdit] = useState('');

          useEffect(() => {
            const datos = {
              nombre: localStorage.getItem('nombreMedico') || '',
              cedula: localStorage.getItem('cedulaMedico') || '',
              whatsapp: localStorage.getItem('numeroWhatsApp') || '',
              esAdmin: localStorage.getItem('esAdministrador') === 'true',
              adminWA: localStorage.getItem('numeroAdministrador') || '',
              pin: localStorage.getItem('pinAdministrador') || ''
            };
            
            if (datos.nombre) {
              setNombre(datos.nombre);
              setCedula(datos.cedula);
              setWhatsapp(datos.whatsapp);
              setEsAdmin(datos.esAdmin);
              setAdminWA(datos.adminWA);
              setPinSaved(datos.pin);
              setPerfilOk(true);
              cargarMisRegistros(datos.nombre);
            } else {
              setConfig(true);
            }

            const qGuardados = localStorage.getItem('quirofanos');
            if (qGuardados) {
              setQuirofanos(JSON.parse(qGuardados));
            } else {
              inicializarQuirofanos();
            }
          }, []);

          const cargarMisRegistros = async (nom) => {
            try {
              const todos = await supabase.select('registros');
              setRegistros(todos.filter(r => r.medico === nom));
            } catch (e) {
              console.error(e);
            }
          };

          const inicializarQuirofanos = () => {
            const q = [];
            for (let i = 16; i <= 35; i++) {
              q.push({id: i, nombre: `Quir√≥fano ${i}`, codigo: `QF${String(i).padStart(3, '0')}`, tipo: 'quirofano'});
            }
            const sp = ['Hemo 1', 'Hemo 2', 'Invasiva 1', 'Invasiva 2', 'Broncoscopia', 'Colon y Recto', 'RNM', 'EcoTE', 'Urolog√≠a 1', 'Urolog√≠a 2', 'Urolog√≠a 3', 'Endocopia 1', 'Endocopia 2', 'CPRE', 'USG', 'Braquiterapia', 'Hematolog√≠a'];
            for (let i = 1; i <= 17; i++) {
              q.push({id: 100 + i, nombre: sp[i-1], codigo: `SP${String(i).padStart(3, '0')}`, tipo: 'periferico'});
            }
            setQuirofanos(q);
            localStorage.setItem('quirofanos', JSON.stringify(q));
          };

          const guardarPerfil = () => {
            if (!nombre.trim()) return alert('‚ö†Ô∏è Ingresa tu nombre');
            if (esAdmin && !pin) return alert('‚ö†Ô∏è Configura un PIN');
            
            localStorage.setItem('nombreMedico', nombre);
            localStorage.setItem('cedulaMedico', cedula);
            localStorage.setItem('numeroWhatsApp', whatsapp);
            localStorage.setItem('esAdministrador', esAdmin.toString());
            localStorage.setItem('numeroAdministrador', adminWA);
            if (esAdmin) {
              localStorage.setItem('pinAdministrador', pin);
              setPinSaved(pin);
            }
            setPerfilOk(true);
            setConfig(false);
            cargarMisRegistros(nombre);
            alert('‚úÖ Perfil guardado');
          };

          const handleQRScan = (codigoQR) => {
            setShowScanner(false);
            setCodigo(codigoQR.toUpperCase());
            // Auto-escanear despu√©s de leer el QR
            setTimeout(() => {
              escanear(codigoQR.toUpperCase());
            }, 100);
          };

          const escanear = async (codigoManual) => {
            const codigoUsar = codigoManual || codigo;
            
            if (!perfilOk) {
              setConfig(true);
              return alert('‚ö†Ô∏è Configura tu perfil');
            }
            
            const q = quirofanos.find(x => x.codigo === codigoUsar.trim().toUpperCase());
            if (!q) return alert('‚ùå C√≥digo inv√°lido: ' + codigoUsar);

            const now = new Date();
            const reg = {
              id: Date.now(),
              medico: nombre,
              cedula: cedula || null,
              quirofano: q.nombre,
              codigo: q.codigo,
              tipo: q.tipo,
              fecha: now.toLocaleDateString('es-MX', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'}),
              hora: now.toLocaleTimeString('es-MX', {hour: '2-digit', minute: '2-digit', second: '2-digit'}),
              timestamp: now.getTime()
            };

            try {
              await supabase.insert('registros', reg);
              setRegistros([reg, ...registros]);
              
              if (adminWA) {
                const msg = `üîî *NUEVA ENTRADA*\n\nüë®‚Äç‚öïÔ∏è ${reg.medico}\nüìç ${reg.quirofano}\nüìÖ ${reg.fecha}\nüïê ${reg.hora}`;
                window.open(`https://wa.me/${adminWA.replace(/\D/g, '')}?text=${encodeURIComponent(msg)}`, '_blank');
              }
              
              if (whatsapp) {
                const msg = `üè• *REGISTRO*\n\nüë®‚Äç‚öïÔ∏è ${reg.medico}\nüìç ${reg.quirofano}\nüìÖ ${reg.fecha}\nüïê ${reg.hora}`;
                setTimeout(() => window.open(`https://wa.me/${whatsapp.replace(/\D/g, '')}?text=${encodeURIComponent(msg)}`, '_blank'), 500);
              }
              
              alert(`‚úÖ Registrado:\n${q.nombre}\n${reg.hora}`);
              setCodigo('');
              setView('registros');
            } catch (e) {
              alert('‚ö†Ô∏è Error al guardar');
            }
          };

          const cargarTodos = async () => {
            setLoading(true);
            try {
              const todos = await supabase.select('registros');
              setTodosRegistros(todos);
            } catch (e) {
              alert('‚ö†Ô∏è Error al cargar');
            }
            setLoading(false);
          };

          const exportCSV = (lista) => {
            if (!lista.length) return alert('‚ö†Ô∏è Sin registros');
            let csv = 'M√©dico,C√©dula,Ubicaci√≥n,Tipo,C√≥digo,Fecha,Hora\n';
            lista.forEach(r => {
              csv += `"${r.medico}","${r.cedula||'N/A'}","${r.quirofano}","${r.tipo === 'quirofano' ? 'Quir√≥fano' : 'Servicio'}","${r.codigo}","${r.fecha}","${r.hora}"\n`;
            });
            const blob = new Blob([csv], {type: 'text/csv'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `registros_${Date.now()}.csv`;
            link.click();
          };

          if (pinPrompt) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 p-4 flex items-center justify-center">
                <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
                  <h2 className="text-2xl font-bold text-center mb-4">üîí PIN Administrador</h2>
                  <input
                    type="password"
                    value={pinInput}
                    onChange={(e) => setPinInput(e.target.value)}
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    className="w-full p-4 text-center text-2xl border-2 rounded-lg mb-4"
                    maxLength="4"
                    onKeyPress={(e) => {
                      if (e.key === 'Enter') {
                        if (pinInput === pinSaved) {
                          setView('admin');
                          cargarTodos();
                          setPinPrompt(false);
                          setPinInput('');
                        } else {
                          alert('‚ùå PIN incorrecto');
                          setPinInput('');
                        }
                      }
                    }}
                  />
                  <button
                    onClick={() => {
                      if (pinInput === pinSaved) {
                        setView('admin');
                        cargarTodos();
                        setPinPrompt(false);
                        setPinInput('');
                      } else {
                        alert('‚ùå PIN incorrecto');
                        setPinInput('');
                      }
                    }}
                    className="w-full bg-yellow-500 text-white py-3 rounded-lg font-bold mb-2"
                  >
                    Verificar
                  </button>
                  <button
                    onClick={() => {setPinPrompt(false); setPinInput('');}}
                    className="w-full bg-gray-200 py-2 rounded-lg"
                  >
                    Cancelar
                  </button>
                </div>
              </div>
            );
          }

          if (config) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 p-4 flex items-center justify-center">
                <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full max-h-screen overflow-y-auto">
                  <h2 className="text-2xl font-bold text-center mb-6">Configurar Perfil</h2>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-bold mb-2">Nombre Completo *</label>
                      <input type="text" value={nombre} onChange={(e) => setNombre(e.target.value)} placeholder="Dr. Juan P√©rez" className="w-full p-3 border-2 rounded-lg" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold mb-2">C√©dula (opcional)</label>
                      <input type="text" value={cedula} onChange={(e) => setCedula(e.target.value)} placeholder="1234567" className="w-full p-3 border-2 rounded-lg" />
                    </div>
                    <div>
                      <label className="block text-sm font-bold mb-2">Tu WhatsApp (opcional)</label>
                      <input type="tel" value={whatsapp} onChange={(e) => setWhatsapp(e.target.value)} placeholder="+52XXXXXXXXXX" className="w-full p-3 border-2 rounded-lg" />
                    </div>
                    <div className="border-t pt-4">
                      <label className="flex items-center gap-2">
                        <input type="checkbox" checked={esAdmin} onChange={(e) => setEsAdmin(e.target.checked)} className="w-5 h-5" />
                        <span className="font-bold">Soy administrador üõ°Ô∏è</span>
                      </label>
                    </div>
                    {esAdmin && (
                      <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 space-y-3">
                        <div>
                          <label className="block text-sm font-bold mb-2">PIN (4 d√≠gitos) *</label>
                          <input type="password" value={pin} onChange={(e) => setPin(e.target.value.replace(/\D/g, '').slice(0, 4))} placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxLength="4" className="w-full p-3 text-center text-xl border-2 rounded-lg" />
                        </div>
                        <div>
                          <label className="block text-sm font-bold mb-2">WhatsApp Admin *</label>
                          <input type="tel" value={adminWA} onChange={(e) => setAdminWA(e.target.value)} placeholder="+52XXXXXXXXXX" className="w-full p-3 border-2 rounded-lg" />
                        </div>
                      </div>
                    )}
                    <button onClick={guardarPerfil} className="w-full bg-blue-500 text-white py-3 rounded-lg font-bold">
                      Guardar
                    </button>
                    {perfilOk && (
                      <button onClick={() => setConfig(false)} className="w-full bg-gray-200 py-2 rounded-lg">
                        Cancelar
                      </button>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 p-4">
              {showScanner && <QRScanner onScan={handleQRScan} onClose={() => setShowScanner(false)} />}
              
              <div className="max-w-4xl mx-auto">
                <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                  <div className="flex justify-between items-start">
                    <div>
                      <h1 className="text-2xl font-bold">Control de Quir√≥fanos</h1>
                      <p className="text-gray-600">Dr(a). {nombre} {esAdmin && <span className="bg-yellow-400 text-yellow-900 px-2 py-0.5 rounded text-xs font-bold ml-2">ADMIN</span>}</p>
                      <p className="text-xs text-green-600 font-bold">üîó Conectado a Supabase</p>
                    </div>
                    <button onClick={() => setConfig(true)} className="bg-gray-100 p-3 rounded-lg">‚öôÔ∏è</button>
                  </div>
                </div>

                <div className="bg-white rounded-xl shadow-lg p-4 mb-6">
                  <div className={`grid ${esAdmin ? 'grid-cols-4' : 'grid-cols-3'} gap-3`}>
                    <button onClick={() => setView('menu')} className={`p-4 rounded-lg font-bold ${view === 'menu' ? 'bg-blue-500 text-white' : 'bg-gray-100'}`}>
                      C√≥digos QR
                    </button>
                    <button onClick={() => setView('escanear')} className={`p-4 rounded-lg font-bold ${view === 'escanear' ? 'bg-blue-500 text-white' : 'bg-gray-100'}`}>
                      Escanear
                    </button>
                    <button onClick={() => setView('registros')} className={`p-4 rounded-lg font-bold ${view === 'registros' ? 'bg-blue-500 text-white' : 'bg-gray-100'}`}>
                      Mis Registros
                    </button>
                    {esAdmin && (
                      <button onClick={() => setPinPrompt(true)} className={`p-4 rounded-lg font-bold ${view === 'admin' ? 'bg-yellow-500 text-white' : 'bg-yellow-100'}`}>
                        üõ°Ô∏è Admin
                      </button>
                    )}
                  </div>
                </div>

                {view === 'menu' && (
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {quirofanos.map(q => (
                      <div key={q.id} className={`bg-white rounded-xl shadow-lg p-6 border-2 ${q.tipo === 'quirofano' ? 'border-blue-200' : 'border-purple-200'}`}>
                        {editando === q.id ? (
                          <div className="space-y-2">
                            <input
                              type="text"
                              value={nombreEdit}
                              onChange={(e) => setNombreEdit(e.target.value)}
                              className="w-full p-2 border-2 rounded"
                              onKeyPress={(e) => {
                                if (e.key === 'Enter') {
                                  const nq = quirofanos.map(x => x.id === q.id ? {...x, nombre: nombreEdit.trim()} : x);
                                  setQuirofanos(nq);
                                  localStorage.setItem('quirofanos', JSON.stringify(nq));
                                  setEditando(null);
                                }
                              }}
                            />
                            <div className="flex gap-2">
                              <button
                                onClick={() => {
                                  const nq = quirofanos.map(x => x.id === q.id ? {...x, nombre: nombreEdit.trim()} : x);
                                  setQuirofanos(nq);
                                  localStorage.setItem('quirofanos', JSON.stringify(nq));
                                  setEditando(null);
                                }}
                                className="flex-1 bg-green-500 text-white py-1 rounded text-xs"
                              >
                                ‚úì Guardar
                              </button>
                              <button onClick={() => setEditando(null)} className="flex-1 bg-gray-300 py-1 rounded text-xs">
                                ‚úï Cancelar
                              </button>
                            </div>
                          </div>
                        ) : (
                          <>
                            <div className="flex justify-between mb-4">
                              <div>
                                <span className={`text-xs px-2 py-1 rounded ${q.tipo === 'quirofano' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}`}>
                                  {q.tipo === 'quirofano' ? 'Quir√≥fano' : 'Servicio'}
                                </span>
                                <h3 className="font-bold mt-2">{q.nombre}</h3>
                                <p className="text-sm text-gray-600">{q.codigo}</p>
                              </div>
                              <button onClick={() => {setEditando(q.id); setNombreEdit(q.nombre);}} className="text-blue-500">‚úèÔ∏è</button>
                            </div>
                            <div className="flex justify-center">
                              <QRGen text={q.codigo} />
                            </div>
                          </>
                        )}
                      </div>
                    ))}
                  </div>
                )}

                {view === 'escanear' && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <div className="text-center mb-6">
                      <div className="bg-blue-100 w-24 h-24 rounded-full mx-auto mb-4 flex items-center justify-center text-4xl">
                        üì∑
                      </div>
                      <h2 className="text-2xl font-bold mb-2">Registrar Entrada</h2>
                      <div className="bg-blue-50 p-3 rounded-lg inline-block">
                        <p className="font-bold">üë®‚Äç‚öïÔ∏è Dr(a). {nombre}</p>
                      </div>
                    </div>
                    <div className="max-w-md mx-auto space-y-4">
                      <button
                        onClick={() => setShowScanner(true)}
                        className="w-full bg-purple-500 text-white py-4 rounded-lg font-bold text-lg flex items-center justify-center gap-2"
                      >
                        üì∑ Escanear con C√°mara
                      </button>
                      
                      <div className="text-center text-gray-500 font-bold">- O -</div>
                      
                      <input
                        type="text"
                        value={codigo}
                        onChange={(e) => setCodigo(e.target.value.toUpperCase())}
                        placeholder="Escribir c√≥digo: QF016 o SP001"
                        className="w-full p-4 text-lg border-2 rounded-lg text-center uppercase font-mono"
                        onKeyPress={(e) => e.key === 'Enter' && escanear()}
                      />
                      <button onClick={() => escanear()} className="w-full bg-green-500 text-white py-4 rounded-lg font-bold text-lg">
                        ‚úì Registrar Mi Entrada
                      </button>
                    </div>
                  </div>
                )}

                {view === 'registros' && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-4">Mis Registros</h2>
                    {registros.length === 0 ? (
                      <div className="text-center py-12 text-gray-500">
                        <p>No hay registros</p>
                      </div>
                    ) : (
                      <div className="space-y-3">
                        {registros.map(r => (
                          <div key={r.id} className={`border-2 rounded-lg p-4 ${r.tipo === 'quirofano' ? 'border-blue-200 bg-blue-50' : 'border-purple-200 bg-purple-50'}`}>
                            <span className={`text-xs px-2 py-1 rounded ${r.tipo === 'quirofano' ? 'bg-blue-200 text-blue-800' : 'bg-purple-200 text-purple-800'}`}>
                              {r.tipo === 'quirofano' ? 'Quir√≥fano' : 'Servicio'}
                            </span>
                            <h3 className="font-bold text-lg mt-1">{r.quirofano}</h3>
                            <p className="text-sm">üìÖ {r.fecha}</p>
                            <p className="text-sm">üïê {r.hora}</p>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                )}

                {view === 'admin' && (
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <div className="flex justify-between items-center mb-6">
                      <div>
                        <h2 className="text-2xl font-bold">üõ°Ô∏è Panel Administraci√≥n</h2>
                        <p className="text-gray-600">Supabase</p>
                      </div>
                      <button onClick={cargarTodos} disabled={loading} className="bg-blue-500 text-white px-4 py-2 rounded-lg">
                        {loading ? '‚è≥' : 'üîÑ'} Actualizar
                      </button>
                    </div>
                    {loading ? (
                      <div className="text-center py-12">Cargando...</div>
                    ) : todosRegistros.length === 0 ? (
                      <div className="text-center py-12 text-gray-500">Sin registros</div>
                    ) : (
                      <>
                        <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4 mb-6">
                          <h3 className="font-bold mb-4">üìä Resumen</h3>
                            <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className="bg-white rounded-lg p-3">
                              <p className="text-xs text-gray-600">Total</p>
                              <p className="text-2xl font-bold text-blue-600">{todosRegistros.length}</p>
                            </div>
                            <div className="bg-white rounded-lg p-3">
                              <p className="text-xs text-gray-600">M√©dicos</p>
                              <p className="text-2xl font-bold text-purple-600">{new Set(todosRegistros.map(r => r.medico)).size}</p>
                            </div>
                          </div>
                          <button onClick={() => exportCSV(todosRegistros)} className="w-full bg-green-500 text-white py-2 rounded-lg font-bold">
                            üì• Exportar Excel
                          </button>
                        </div>
                        <div className="space-y-3 max-h-96 overflow-y-auto">
                          {todosRegistros.map(r => (
                            <div key={r.id} className="border-2 rounded-lg p-4">
                              <span className={`text-xs px-2 py-1 rounded ${r.tipo === 'quirofano' ? 'bg-blue-100' : 'bg-purple-100'}`}>
                                {r.tipo === 'quirofano' ? 'Quir√≥fano' : 'Servicio'}
                              </span>
                              <h3 className="font-bold mt-1">{r.quirofano}</h3>
                              <p className="text-sm">üë®‚Äç‚öïÔ∏è {r.medico}</p>
                              <p className="text-xs text-gray-600">üìÖ {r.fecha} ‚Ä¢ üïê {r.hora}</p>
                            </div>
                          ))}
                        </div>
                      </>
                    )}
                  </div>
                )}
              </div>
            </div>
          );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
